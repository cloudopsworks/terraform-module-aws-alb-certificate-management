name: AWS ALB Certificate Management Terraform Module

license: "APACHE2"

copyrights:
  - name: "Cloud Ops Works LLC"
    url: "https://cloudops.works"
    year: "2024"

github_repo: cloudopsworks/terraform-module-aws-alb-certificate-management

description: |-
  This Terraform module automates the management of SSL/TLS certificates for AWS Application Load Balancers (ALB). It streamlines the process of certificate creation, DNS validation via Route53, and seamless attachment to ALB listeners, supporting both simple and complex multi-domain configurations.

introduction: |-
  Ensuring secure communication is critical for modern web applications. This module provides a robust and flexible way to handle AWS Certificate Manager (ACM) certificates. Key features include:
  - **Automated ACM Lifecycle**: Handles creation and validation of certificates.
  - **Route53 Integration**: Supports automatic DNS validation record creation.
  - **ALB Attachment**: Automatically associates certificates with specified ALB listeners.
  - **Multi-Domain Support**: Easily configure Subject Alternative Names (SANs).
  - **Cross-Account Support**: Ability to manage certificates across different AWS accounts.
  - **Flexible Configuration**: Define certificates using a clean YAML-based structure.

usage: |-
  ### Terragrunt Implementation
  To use this module with Terragrunt, define your configuration in the `inputs` block. This module is designed to work seamlessly with YAML-like structures within Terragrunt/HCL.

  #### Core Variables Table
  | Name | Description | Required | Default |
  |------|-------------|:--------:|---------|
  | `org` | Organization and environment details | Yes | N/A |
  | `certificates` | Map of certificate configurations | Yes | `{}` |
  | `dns_zone_domain` | DNS zone domain for Route53 validation | No | `""` |
  | `lb_arn` | ARN of the target Load Balancer | No | `""` |

  #### Full Variables Structure (YAML Format)
  The following represents the complete structure for all available variables:

  ```yaml
  # Organization settings
  org:
    organization_name: "example" # (Required) Organization name
    organization_unit: "devops"  # (Required) Organizational unit
    environment_type: "production" # (Required) Environment type (e.g., prod, dev)
    environment_name: "prod"      # (Required) Specific environment name

  # DNS Configuration
  dns_zone_domain: "example.com" # (Optional) DNS zone domain. Default: ""
  dns_zone_id: "Z1234567890"    # (Optional) DNS zone ID. Default: ""
  private_dns_zone: false        # (Optional) Is the DNS zone private? Default: false
  external_dns_zone: false       # (Optional) Is the DNS zone external? Default: false

  # Load Balancer Integration
  lb_arn: "arn:aws:..."                      # (Optional) ALB ARN. Default: ""
  load_balancer_listener_arn: "arn:aws:..."  # (Optional) Specific listener ARN. Default: ""
  load_balancer_listener_port: 443           # (Optional) Default listener port. Default: -1

  # Certificate Definitions
  certificates:
    main-cert:                    # (Required) Unique identifier for the certificate
      domain_name: "example.com"  # (Required) Primary domain name
      subject_alternative_names:  # (Optional) List of SANs. Default: []
        - "www.example.com"
      validation_method: "DNS"    # (Optional) DNS or EMAIL. Default: DNS
      validation_domain: "example.com" # (Optional) Domain for validation. Default: ""
      key_algorithm: "RSA_2048"   # (Optional) RSA_2048 or ECDSA_P256. Default: RSA_2048
      validation_option:          # (Optional) List of validation options for different domains. Default: []
        - domain_name: "example.com"
          validation_domain: "example.com" # (Optional) domain for validation, defaults to domain_name
      listener_port: 443          # (Optional) Port override for this cert. Default: load_balancer_listener_port
      listener_arn: "arn:aws:..." # (Optional) Specific listener ARN. Default: ""
      tags:                       # (Optional) Certificate specific tags. Default: {}
        Environment: "production"
      options:                    # (Optional) ACM options
        certificate_transparency_logging_preference: true # (Optional) Default: true

  # Advanced Settings
  is_hub: false        # (Optional) Is this a hub configuration? Default: false
  spoke_def: "001"     # (Optional) Spoke ID (3-digit). Default: "001"
  cross_account: false # (Optional) Cross-account validation. Default: false
  extra_tags: {}       # (Optional) Additional tags for all resources. Default: {}
  ```

examples: |-
  ### Standard Terragrunt Configuration
  Example of a `terragrunt.hcl` using this module for a production environment:

  ```hcl
  terraform {
    source = "git::https://github.com/cloudopsworks/terraform-module-aws-alb-certificate-management.git?ref=v1.0.0"
  }

  inputs = {
    org = {
      organization_name = "cloudopsworks"
      organization_unit = "platform"
      environment_type  = "prod"
      environment_name  = "main"
    }

    dns_zone_domain = "cloudops.works"
    lb_arn          = "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/prod-alb/abc123def456"

    certificates = {
      "app-prod" = {
        domain_name               = "app.cloudops.works"
        subject_alternative_names = ["*.app.cloudops.works"]
        validation_method         = "DNS"
        listener_port             = 443
      }
    }
  }
  ```

quickstart: |-
  1. **Prepare Terragrunt**: Create a `terragrunt.hcl` in your environment directory.
  2. **Configure Inputs**: Set your `org` details and define your `certificates` map.
  3. **Verify AWS Access**: Ensure your environment has the necessary permissions to manage ACM and Route53.
  4. **Execute**:
     ```bash
     terragrunt init
     terragrunt plan
     terragrunt apply
     ```

include:
  - "docs/targets.md"
  - "docs/terraform.md"

contributors:
  - name: "Cristian Beraha"
    github: "berahac"